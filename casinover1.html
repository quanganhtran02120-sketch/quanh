<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quay hũ + Click Earn </title>
  <style>
    /* --- Base layout (adapted) --- */
    body {
      width: 360px;
      min-height: 560px;
      font-family: "Trebuchet MS", system-ui, Arial, sans-serif;
      background: linear-gradient(180deg,#071021,#020417);
      color: #e6eef8;
      margin: 14px auto;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
    }

    .title { text-align: center; margin-bottom: 8px; }
    .titleWords { font-size: 20px; font-weight: 800; color: #ffcc4d; }

    .casinoArea {
      display: block;
      padding: 12px;
      border-radius: 8px;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: inset 0 2px 6px rgba(255,255,255,0.02);
    }

    .casinoWord { font-size: 18px; display:block; text-align:center; margin-bottom:6px; }
    .casinoMoneyRow { display:flex; justify-content:center; gap:6px; align-items:baseline; margin-bottom:8px; }
    .casinoMoney { font-size: 14px; color: #cfe9d8; }
    #casino_money { font-weight: 700; color: #fff; margin-left:6px; }

    /* Earn-by-click box */
    .earnBox {
      width: 100%;
      height: 62px;
      border-radius: 8px;
      background: linear-gradient(180deg,#0b1622,#07101a);
      border: 1px solid rgba(255,255,255,0.04);
      display:flex;
      align-items:center;
      justify-content:center;
      margin: 8px 0 12px;
      cursor: pointer;
      user-select: none;
      position: relative;
      transition: transform 120ms ease, box-shadow 160ms;
    }
    .earnBox:hover { transform: translateY(-3px); box-shadow: 0 10px 28px rgba(0,0,0,0.6); }
    .earnBoxLabel { font-size: 15px; color: #dbeafe; font-weight:700; }

    /* slots */
    .slots {
      display:flex;
      justify-content:center;
      gap:12px;
      margin: 12px 0 12px;
      position: relative;
      height: 84px;
    }
    .slotDiv {
      width: 76px;
      height: 84px;
      border-radius: 8px;
      background: linear-gradient(180deg,#07121a,#020613);
      border: 2px solid rgba(255,255,255,0.04);
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      overflow: hidden;
    }
    .slotDigit {
      font-size: 44px;
      font-weight: 900;
      color: #fff;
      line-height: 1;
      user-select: none;
      transform-origin: center;
    }
    .spinning {
      animation: spinFaces 85ms linear infinite;
    }
    @keyframes spinFaces {
      from { transform: translateY(0) }
      to { transform: translateY(-2px) }
    }
    .slotDiv.win {
      box-shadow: 0 10px 30px rgba(34,197,94,0.18), 0 0 0 6px rgba(34,197,94,0.06) inset;
      border-color: rgba(34,197,94,0.9);
    }
    .slotDiv.lose {
      box-shadow: 0 10px 30px rgba(239,68,68,0.12);
      border-color: rgba(239,68,68,0.8);
    }

    .controls { text-align:center; margin-top:6px; }
    input[type=number]#gamble_input {
      width: 160px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.06);
      background: transparent;
      color: inherit;
      font-size: 14px;
    }
    button.gambleButton {
      margin-top: 10px;
      padding: 8px 14px;
      border-radius: 8px;
      background: linear-gradient(180deg,#f4f4f4,#e9e9e9);
      border: 1px solid rgba(0,0,0,0.2);
      color: #041225;
      font-weight: 700;
      cursor: pointer;
      transition: transform .08s ease;
    }
    button.gambleButton:active { transform: translateY(1px); }
    button.gambleButton[disabled] { opacity: 0.55; cursor: not-allowed; }

    .gambleMessage { margin-top: 10px; min-height: 28px; font-size: 13px; color: #e6eef8; text-align:center; }

    .payoutInfo { margin-top: 8px; font-size: 12px; color: #94a3b8; text-align:center; }

    .footerNote { margin-top: 14px; font-size: 11px; color: #94a3b8; text-align:center; }

    /* floating +$ animation */
    .floatGain {
      position: absolute;
      font-weight: 800;
      color: #bbf7d0;
      font-size: 15px;
      pointer-events: none;
      transform: translateY(0);
      opacity: 1;
      transition: transform 900ms ease-out, opacity 900ms ease-out;
      text-shadow: 0 6px 18px rgba(0,0,0,0.6);
    }
  </style>
</head>
<body>
  <div class="title">
    <div class="titleWords">CASINO CỦA QUANH</div>
  </div>

  <div class="casinoArea" id="casino_area">
    <div class="casinoMoneyRow">
      <span class="casinoMoney">Money:</span>
      <span class="casinoMoney" id="casino_money">$1000</span>
    </div>

    <!-- Earn-by-click box: each click = $10 -->
    <div class="earnBox" id="earn_box" title="Click để nhận $10">
      <div class="earnBoxLabel">Click here to earn +$100</div>
    </div>

    <div class="slots" aria-hidden="false">
      <div class="slotDiv" id="slot_1"><div class="slotDigit" id="slot_1_digit">0</div></div>
      <div class="slotDiv" id="slot_2"><div class="slotDigit" id="slot_2_digit">0</div></div>
      <div class="slotDiv" id="slot_3"><div class="slotDigit" id="slot_3_digit">0</div></div>
    </div>

    <div style="text-align:center;">
      <div class="payoutInfo">
       
      </div>
    </div>

    <div class="controls">
      <input type="number" id="gamble_input" placeholder="Enter bet amount" min="1" />
      <br>
      <button class="gambleButton" id="gamble_button">GAMBLE</button>
      <div class="gambleMessage" id="gamble_message"></div>
    </div>

    <div class="footerNote">Cooldown: 4s per spin. Numbers are 1–7 inclusive.</div>
  </div>

  <script>
    (function(){
      // Elements
      const moneyEl = document.getElementById('casino_money');
      const slot1El = document.getElementById('slot_1_digit');
      const slot2El = document.getElementById('slot_2_digit');
      const slot3El = document.getElementById('slot_3_digit');
      const slot1Wrap = document.getElementById('slot_1');
      const slot2Wrap = document.getElementById('slot_2');
      const slot3Wrap = document.getElementById('slot_3');
      const gambleInput = document.getElementById('gamble_input');
      const gambleBtn = document.getElementById('gamble_button');
      const msgEl = document.getElementById('gamble_message');
      const earnBox = document.getElementById('earn_box');
      const STORAGE_KEY = 'mm_casino_money_v1';

      // Config
      const COOLDOWN_MS = 4000;
      const DIGIT_MIN = 1;
      const DIGIT_MAX = 7;
      const CLICK_EARN_AMOUNT = 100; // each click gives $10

      // State
      let money = parseFloat(localStorage.getItem(STORAGE_KEY) || '1000');
      let lastSpinAt = 0;
      updateMoneyDisplay();
      setMsg('Ready', '#93c5fd');

      // Helpers
      function randInt(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }
      function setMsg(text, color){ msgEl.textContent = text; msgEl.style.color = color || '#e6eef8'; }
      function updateMoneyDisplay(){
        moneyEl.textContent = '$' + formatNumber(money);
        localStorage.setItem(STORAGE_KEY, String(money));
      }
      function formatNumber(n){
        if (Math.abs(Math.round(n) - n) < 1e-9) return new Intl.NumberFormat().format(Math.round(n));
        return new Intl.NumberFormat(undefined, { maximumFractionDigits: 2 }).format(n);
      }

      // Evaluate spin outcome
      function evaluateSpin(d1, d2, d3){
        const arr = [d1,d2,d3];
        const counts = {};
        for (const v of arr) counts[v] = (counts[v] || 0) + 1;
        // triples
        for (const v in counts){
          if (counts[v] === 3){
            if (Number(v) === 7) return { multiplier: 25, reason: '3 sevens' };
            else return { multiplier: 8, reason: '3 of a kind' };
          }
        }
        // doubles
        if ((counts[7] || 0) === 2) return { multiplier: 8, reason: '2 sevens' };
        for (const v in counts){
          if (counts[v] === 2){
            return { multiplier: 3, reason: '2 of a kind' };
          }
        }
        return { multiplier: 0, reason: 'no win' };
      }

      // Spin animation
      function spinReels(finals, durations = [900, 1200, 1500]){
        return new Promise((resolve) => {
          const spinIntervals = [];
          [slot1El, slot2El, slot3El].forEach((el, idx) => {
            el.classList.add('spinning');
            spinIntervals[idx] = setInterval(() => {
              el.textContent = String(randInt(DIGIT_MIN, DIGIT_MAX));
            }, 70 + Math.floor(Math.random() * 40));
          });

          const stopAt = (idx) => {
            clearInterval(spinIntervals[idx]);
            [slot1El, slot2El, slot3El][idx].classList.remove('spinning');
            const el = [slot1El, slot2El, slot3El][idx];
            el.textContent = String(finals[idx]);
            el.style.transform = 'scale(1.08)';
            setTimeout(()=> el.style.transform = '', 140);
          };

          setTimeout(()=> stopAt(0), durations[0]);
          setTimeout(()=> stopAt(1), durations[1]);
          setTimeout(()=> {
            stopAt(2);
            setTimeout(()=> resolve(), 220);
          }, durations[2]);
        });
      }

      // Gamble click handler
      gambleBtn.addEventListener('click', async () => {
        const now = Date.now();
        if (now - lastSpinAt < COOLDOWN_MS){
          const wait = Math.ceil((COOLDOWN_MS - (now - lastSpinAt)) / 1000);
          setMsg(`Cooldown — wait ${wait}s`, '#fbbf24');
          return;
        }

        let bet = Number(gambleInput.value);
        if (!isFinite(bet) || bet <= 0){
          setMsg('Nhập số cược hợp lệ (>0)', '#f87171');
          return;
        }
        bet = Math.floor(bet);
        if (bet > money){
          setMsg('Không đủ tiền', '#f87171');
          return;
        }

        // Deduct bet
        money -= bet;
        updateMoneyDisplay();
        setMsg('Spinning...', '#a3e635');
        gambleBtn.disabled = true;
        gambleInput.disabled = true;

        // Determine finals
        const final1 = randInt(DIGIT_MIN, DIGIT_MAX);
        const final2 = randInt(DIGIT_MIN, DIGIT_MAX);
        const final3 = randInt(DIGIT_MIN, DIGIT_MAX);
        const finals = [final1, final2, final3];

        try { await spinReels(finals); } catch(e){ console.error(e); }

        const evalResult = evaluateSpin(final1, final2, final3);
        const multiplier = evalResult.multiplier;
        let payout = 0;
        if (multiplier > 0){
          payout = bet * multiplier;
          money += payout;
          updateMoneyDisplay();
          setMsg(`WIN! ${final1}-${final2}-${final3} • ×${multiplier} → +$${formatNumber(payout)}`, '#22c55e');
          highlightResult(true);
        } else {
          setMsg(`LOSE • ${final1}-${final2}-${final3} • -$${formatNumber(bet)}`, '#ef4444');
          highlightResult(false);
        }

        lastSpinAt = Date.now();
        startCooldown(COOLDOWN_MS);
      });

      // Visual highlight
      function highlightResult(isWin){
        const cls = isWin ? 'win' : 'lose';
        [slot1Wrap, slot2Wrap, slot3Wrap].forEach(s => s.classList.add(cls));
        setTimeout(()=> {
          [slot1Wrap, slot2Wrap, slot3Wrap].forEach(s => s.classList.remove(cls));
        }, 1100);
      }

      // Cooldown UI
      function startCooldown(ms){
        const start = Date.now();
        gambleBtn.disabled = true;
        let remaining = ms;
        const origText = gambleBtn.textContent;
        const interval = setInterval(()=>{
          const elapsed = Date.now() - start;
          remaining = Math.max(0, ms - elapsed);
          gambleBtn.textContent = `Wait ${Math.ceil(remaining/1000)}s`;
          if (remaining <= 0){
            clearInterval(interval);
            gambleBtn.disabled = false;
            gambleInput.disabled = false;
            gambleBtn.textContent = origText;
            setMsg('Ready', '#93c5fd');
          }
        }, 250);
      }

      // Init slots
      function initSlots(){
        slot1El.textContent = String(randInt(DIGIT_MIN, DIGIT_MAX));
        slot2El.textContent = String(randInt(DIGIT_MIN, DIGIT_MAX));
        slot3El.textContent = String(randInt(DIGIT_MIN, DIGIT_MAX));
      }

      // Earn-by-click functionality: each click = $10
      earnBox.addEventListener('click', (ev) => {
        // Add money
        money += CLICK_EARN_AMOUNT;
        updateMoneyDisplay();
        // Show floating +$10 animation at click position (relative to earnBox)
        const rect = earnBox.getBoundingClientRect();
        const x = ev.clientX - rect.left;
        const y = ev.clientY - rect.top;
        showFloat(`+$${formatNumber(CLICK_EARN_AMOUNT)}`, x, y);
        setMsg(`+ $${formatNumber(CLICK_EARN_AMOUNT)}`, '#bbf7d0');
      });

      function showFloat(text, x, y){
        const span = document.createElement('div');
        span.className = 'floatGain';
        span.textContent = text;
        // position inside earnBox
        span.style.left = (x - 18) + 'px';
        span.style.top = (y - 8) + 'px';
        earnBox.appendChild(span);
        // trigger animation (translate up & fade)
        requestAnimationFrame(()=> {
          span.style.transform = 'translateY(-48px)';
          span.style.opacity = '0';
        });
        setTimeout(()=> { if (span.parentElement) span.parentElement.removeChild(span); }, 1000);
      }

      // Keyboard: Enter to gamble
      gambleInput.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter') gambleBtn.click();
      });

      // Init
      initSlots();

      // Expose debug
      window.mmCasino = {
        getMoney: () => money,
        setMoney: (v) => { money = v; updateMoneyDisplay(); }
      };
    })();
  </script>
</body>
</html>